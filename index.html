<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>VIPER HUNTER V32</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --neon: #00ff41; --bg: #0a0a0c; }
        body { background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; margin: 0; display: grid; grid-template-columns: 420px 1fr; height: 100vh; }
        .sidebar { background: #141417; border-right: 1px solid #222; padding: 25px; display: flex; flex-direction: column; gap: 20px; }
        #monitor { background: #000; padding: 20px; overflow-y: auto; color: #adbac7; font-size: 11px; }
        .stat-card { background: #000; border: 1px solid var(--neon); padding: 12px; border-radius: 4px; box-shadow: 0 0 10px rgba(0,255,65,0.1); }
        .val { font-size: 18px; color: var(--neon); font-weight: bold; }
        input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 4px; box-sizing: border-box; }
        button { background: var(--neon); color: #000; padding: 20px; border: none; font-weight: 900; cursor: pointer; text-transform: uppercase; border-radius: 4px; }
        .highlight { color: #fff; background: #004400; padding: 2px 5px; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="margin:0;">VIPER HUNTER V32</h2>
    
    <div class="stat-card">
        <div>GENERAZIONE ATTIVA</div>
        <div id="displayGen" class="val">0</div>
    </div>

    <div class="stat-card">
        <div>SALDO PAS</div>
        <div id="valBalance" class="val">0.000</div>
    </div>

    <label>INDIRIZZO CONTRATTO</label>
    <input type="text" id="targetAddr" placeholder="0x...">
    
    <label>CHIAVE PRIVATA MASTER</label>
    <input type="password" id="pKey" placeholder="0x...">

    <button onclick="ignite()">ðŸš€ AVVIA INSEGUIMENTO AUTOMATICO</button>
</div>

<div id="monitor">
    <div>> Sistema pronto. In attesa di input iniziale...</div>
</div>

<script>
    const RPC = "https://testnet-passet-hub-eth-rpc.polkadot.io";
    const ABI = [
        "function spawnNext(address[] targets) external",
        "function generation() view returns (uint256)",
        "event NewGeneration(address indexed daughter, uint256 gen)"
    ];

    let active = false;

    function log(msg, type = "") {
        const m = document.getElementById('monitor');
        const color = type === "success" ? "#00ff41" : (type === "err" ? "#ff0055" : "#adbac7");
        m.innerHTML = `<div>[${new Date().toLocaleTimeString()}] <span style="color:${color}">${msg}</span></div>` + m.innerHTML;
    }

    async function ignite() {
        if(active) return;
        active = true;
        loop();
    }

    async function loop() {
        if(!active) return;
        const addr = document.getElementById('targetAddr').value.trim();
        const key = document.getElementById('pKey').value.trim();

        try {
            const provider = new ethers.JsonRpcProvider(RPC);
            const wallet = new ethers.Wallet(key, provider);
            const contract = new ethers.Contract(addr, ABI, wallet);

            // Update Balance
            const bal = await provider.getBalance(wallet.address);
            document.getElementById('valBalance').innerText = parseFloat(ethers.formatEther(bal)).toFixed(3);

            // Update Gen
            const currentGen = await contract.generation();
            document.getElementById('displayGen').innerText = currentGen;

            // Generate Targets
            const randomTargets = Array.from({length: 5}, () => ethers.Wallet.createRandom().address);

            log(`ATTIVAZIONE GEN ${currentGen} su ${addr.substring(0,12)}...`);
            
            const tx = await contract.spawnNext(randomTargets, { gasLimit: 5000000 });
            log(`TX Broadcast: ${tx.hash.substring(0,25)}...`);

            const receipt = await tx.wait();
            log(`Confermata! Gas usato: ${receipt.gasUsed}`, "success");

            // SEARCH FOR THE DAUGHTER IN LOGS (The Hunter logic)
            const topic = ethers.id("NewGeneration(address,uint256)");
            const birthLog = receipt.logs.find(l => l.topics[0] === topic);

            if(birthLog) {
                const daughterAddr = ethers.getAddress("0x" + birthLog.topics[1].slice(26));
                log(`NUOVA FIGLIA RILEVATA: ${daughterAddr}`, "success");
                
                // IL SALTO: Cambiamo l'indirizzo nel campo di testo e nel monitor
                document.getElementById('targetAddr').value = daughterAddr;
                
                log(`Spostamento su Gen ${Number(currentGen)+1} tra 5 secondi...`);
                setTimeout(loop, 5000);
            }

        } catch (e) {
            log(`ERRORE: ${e.message}`, "err");
            active = false;
        }
    }
</script>
</body>
</html>
