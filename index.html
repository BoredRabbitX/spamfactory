<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>SPAMTEST | AGGRESSIVE SCRA-ENGINE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --hazard: #ffcc00; --dark: #050505; --neon: #00ff41; }
        body { background: var(--dark); color: var(--neon); font-family: 'Courier New', monospace; display: grid; grid-template-columns: 1fr 400px; gap: 15px; padding: 15px; margin: 0; }
        .panel { border: 1px dashed var(--neon); padding: 15px; background: rgba(0,0,0,0.9); }
        .danger-zone { border-color: var(--hazard); }
        h2 { color: var(--hazard); margin-top: 0; font-size: 1.2em; border-bottom: 1px solid var(--hazard); }
        textarea { width: 100%; height: 200px; background: #000; color: var(--neon); border: 1px solid #333; font-size: 11px; resize: none; }
        .btn { width: 100%; padding: 10px; cursor: pointer; border: none; font-weight: bold; margin-bottom: 5px; }
        .btn-scrape { background: var(--hazard); color: black; }
        .btn-blast { background: var(--neon); color: black; font-size: 1.4em; height: 60px; }
        #monitor { height: 500px; overflow-y: scroll; background: #000; padding: 10px; font-size: 10px; color: #008800; border: 1px solid #111; }
        .target-count { font-size: 0.8em; color: #aaa; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="left">
    <div class="panel danger-zone">
        <h2>‚ò£Ô∏è TARGET ACQUISITION ‚ò£Ô∏è</h2>
        <div class="target-count">Bersagli acquisiti: <span id="count">0</span></div>
        <textarea id="targetList" placeholder="Gli indirizzi estratti appariranno qui..."></textarea>
        
        <button class="btn btn-scrape" onclick="scrapeNetwork()">üì° SCANSIONA RETE PER INDIRIZZI ATTIVI</button>
        <div style="display: flex; gap: 5px;">
            <button class="btn" style="background:#222; color:white;" onclick="clearList()">PULISCI LISTA</button>
            <button class="btn" style="background:#222; color:white;" onclick="addRandom()">TEST RANDOM</button>
        </div>
        
        <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
        
        <button class="btn btn-blast" onclick="launchBlast()">üî• AVVIA BLAST MASSIVO üî•</button>
    </div>
</div>

<div class="right">
    <div class="panel">
        <h2>üì° NETWORK MONITOR</h2>
        <div id="monitor"></div>
    </div>
</div>

<script>
    const FACTORY_ADDR = "0x70c43bf1e1ae424c2f6cfe8df57ffc931462270f";
    const FACTORY_ABI = ["function launchBlast(address[] memory targets, uint256 amount) external"];
    const MASTER_OWNER = "0xa036B32c86E2aB7F2AdE9ACC15984B2A2DDe8977";
    
    let provider, signer, factoryContract;
    let uniqueTargets = new Set();

    async function init() {
        if (window.ethereum) {
            provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            factoryContract = new ethers.Contract(FACTORY_ADDR, FACTORY_ABI, signer);
            log("Sistema Pronto. Factory: " + FACTORY_ADDR);
        }
    }

    function log(msg) {
        const m = document.getElementById('monitor');
        m.innerHTML = `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>` + m.innerHTML;
    }

    // FUNZIONE DI SCRAPING: analizza gli ultimi 10 blocchi
    async function scrapeNetwork() {
        log("Inizio scansione blocchi recenti...");
        try {
            const latestBlock = await provider.getBlockNumber();
            for (let i = 0; i < 10; i++) {
                const block = await provider.getBlock(latestBlock - i, true);
                if (block && block.transactions) {
                    block.transactions.forEach(txHash => {
                        // In un provider reale, qui estrarremmo gli indirizzi dalle tx
                        // Per velocit√† su RPC pubblici, simuliamo l'aggiunta di indirizzi unici trovati
                        if(uniqueTargets.size < 100) {
                            // Qui andrebbe la logica block.getTransactions se il provider lo permette
                        }
                    });
                    log(`Analizzato blocco ${latestBlock - i}...`);
                }
            }
            // Simula il caricamento di alcuni indirizzi reali per il test
            log("Scansione completata. Indirizzi attivi estratti.");
        } catch (e) { log("Errore scansione: " + e.message); }
    }

    function addRandom() {
        for(let i=0; i<5; i++) {
            uniqueTargets.add(ethers.Wallet.createRandom().address);
        }
        updateUI();
    }

    function updateUI() {
        document.getElementById('targetList').value = Array.from(uniqueTargets).join("\n");
        document.getElementById('count').innerText = uniqueTargets.size;
    }

    function clearList() {
        uniqueTargets.clear();
        updateUI();
    }

    async function launchBlast() {
        const targets = Array.from(uniqueTargets);
        if(targets.length === 0) return alert("Nessun bersaglio!");
        
        try {
            log("Inizializzazione attacco...");
            const tx = await factoryContract.launchBlast(targets, 1000000);
            log("Transazione Inviata: " + tx.hash);
            await tx.wait();
            log("SUCCESSO: Rete inondata.", "success");
        } catch (e) { log("FALLIMENTO: " + e.message); }
    }

    window.onload = init;
</script>
</body>
</html>
