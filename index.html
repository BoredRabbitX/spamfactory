<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>VIPER APOCALYPSE V41</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --danger: #ff0000; --bg: #000; }
        body { background: var(--bg); color: var(--danger); font-family: 'Courier New', monospace; margin: 0; display: grid; grid-template-columns: 420px 1fr; height: 100vh; }
        .sidebar { background: #0a0000; border-right: 2px solid var(--danger); padding: 25px; box-shadow: 10px 0 20px rgba(255,0,0,0.2); }
        #log { background: #000; padding: 20px; overflow-y: auto; font-size: 10px; color: #ff6666; text-shadow: 0 0 2px #ff0000; }
        .stat-card { border: 1px solid var(--danger); padding: 15px; margin-bottom: 10px; background: #1a0000; }
        .val { font-size: 26px; font-weight: 900; color: #fff; }
        button { background: var(--danger); color: #fff; border: none; padding: 25px; width: 100%; font-weight: bold; cursor: pointer; font-size: 18px; letter-spacing: 3px; }
        button:hover { background: #ff4444; }
        .warning { animation: blink 0.5s infinite; color: #fff; font-weight: bold; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.2; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="sidebar">
    <h1 class="warning">APOCALYPSE V41</h1>
    
    <div class="stat-card">
        <label>CODA ATTACCO (CONTRATTI)</label>
        <div id="qCount" class="val">0</div>
    </div>

    <div class="stat-card">
        <label>TARGET COLPITI (TOTALI)</label>
        <div id="tSpam" class="val">0</div>
    </div>

    <input type="text" id="masterAddr" placeholder="GEN 0 ADDRESS" style="width:100%; background: #000; color: #fff; border: 1px solid #444; padding: 10px;">
    <input type="password" id="pKey" placeholder="MASTER PRIVATE KEY" style="width:100%; background: #000; color: #fff; border: 1px solid #444; padding: 10px; margin-top: 10px;">
    
    <button onclick="ignite()">☣️ INIZIA SATURAZIONE</button>

    <div id="status" style="margin-top: 20px; font-size: 10px;">
        MODE: TOTAL SATURATION<br>
        SPREAD: BINARY RECURSIVE<br>
        LOAD: 50 TX/GEN
    </div>
</div>

<div id="log">> STANDBY... AGGRESSIVE PROTOCOL LOADED.</div>

<script>
    const RPC = "https://testnet-passet-hub-eth-rpc.polkadot.io";
    const ABI = ["function spawn(address[] t) external", "function gen() view returns (uint256)", "event NewGen(address indexed daughter, uint256 g)"];
    
    let queue = [];
    let totalSpam = 0;
    let isRunning = false;

    function log(m, cls="") {
        const l = document.getElementById('log');
        l.innerHTML = `<div class="${cls}">[${new Date().toLocaleTimeString()}] ${m}</div>` + l.innerHTML;
    }

    async function ignite() {
        if(isRunning) return;
        const addr = document.getElementById('masterAddr').value.trim();
        if(!addr) return;
        queue.push(addr);
        isRunning = true;
        log("☣️ PROTOCOLLO APOCALYPSE ATTIVATO. SATURAZIONE IN CORSO.", "warning");
        process();
    }

    async function process() {
        if(queue.length === 0) { isRunning = false; return; }
        
        const current = queue.shift();
        document.getElementById('qCount').innerText = queue.length;

        const provider = new ethers.JsonRpcProvider(RPC);
        const wallet = new ethers.Wallet(document.getElementById('pKey').value.trim(), provider);
        const contract = new ethers.Contract(current, ABI, wallet);

        try {
            // Genera 50 target per ogni singola transazione
            const targets = Array.from({length: 50}, () => ethers.Wallet.createRandom().address);
            
            log(`COLPENDO: ${current} con 50 target...`);
            // Gas limit molto alto per gestire i 50 eventi + 2 deploy
            const tx = await contract.spawn(targets, { gasLimit: 15000000 });
            const receipt = await tx.wait();
            
            totalSpam += 50;
            document.getElementById('tSpam').innerText = totalSpam;

            const newGenTopic = ethers.id("NewGen(address,uint256)");
            receipt.logs.forEach(l => {
                if(l.topics[0] === newGenTopic) {
                    const d = ethers.getAddress("0x" + l.topics[1].slice(26));
                    queue.push(d);
                    log(`☢️ NUOVA SORGENTE GENERATA: ${d}`);
                }
            });

            document.getElementById('qCount').innerText = queue.length;
            setTimeout(process, 1000); // Delay minimo, quasi istantaneo

        } catch (e) {
            log(`SALTO CONTRATTO: ${e.message}`, "gray");
            setTimeout(process, 500);
        }
    }
</script>
</body>
</html>
