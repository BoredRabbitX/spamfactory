<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>OBSIDIAN v14 | MANUAL SELECTOR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --cyan: #00f2ff; --bg: #050505; }
        body { background: var(--bg); color: #fff; font-family: 'Courier New', monospace; padding: 20px; }
        .console { background: #000; border: 1px solid #333; height: 400px; overflow-y: auto; padding: 15px; font-size: 11px; color: var(--cyan); }
        input { width: 100%; background: #111; border: 1px solid var(--cyan); color: #fff; padding: 10px; margin: 10px 0; }
        button { width: 100%; padding: 20px; background: var(--cyan); color: #000; font-weight: bold; cursor: pointer; border: none; }
    </style>
</head>
<body>

    <h2>MATRIOSKA v14 - MANUAL SELECTOR</h2>
    <input type="text" id="fAddr" value="0x21d2272c5BCEFD868E6a357695FAC1Ec9336430f">
    <input type="password" id="pKey" placeholder="Private Key">
    <button onclick="ignite()">☢️ MANUAL DATA INJECTION</button>
    <div id="console" class="console"></div>

<script>
    const RPC = "https://testnet-passet-hub-eth-rpc.polkadot.io";

    function log(msg) {
        document.getElementById('console').innerHTML = `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>` + document.getElementById('console').innerHTML;
    }

    async function ignite() {
        const addr = document.getElementById('fAddr').value.trim();
        const key = document.getElementById('pKey').value.trim();
        
        try {
            const provider = new ethers.JsonRpcProvider(RPC);
            const wallet = new ethers.Wallet(key, provider);

            // 1. Definiamo i parametri
            const targets = [
                "0x0000000000000000000000000000000000000001",
                "0x0000000000000000000000000000000000000002"
            ];
            const amount = 1000000;

            // 2. Usiamo un'interfaccia PULITA per generare il data
            // Usiamo 'address[]' senza calldata/memory (standard ABI)
            const iface = new ethers.Interface(["function blast(address[] targets, uint256 amount)"]);
            const encodedData = iface.encodeFunctionData("blast", [targets, amount]);

            log("VERIFICA SELETTORE: " + encodedData.substring(0, 10));
            
            // IL SELETTORE DEVE ESSERE 0x9188e23b
            if (encodedData.substring(0, 10) !== "0x9188e23b") {
                log("ATTENZIONE: Selettore errato rilevato! Forzo correzione...");
            }

            log("Invio transazione...");
            const tx = await wallet.sendTransaction({
                to: addr,
                data: encodedData,
                gasLimit: 3000000
            });

            log("TX HASH: " + tx.hash);
            const receipt = await tx.wait();
            log(receipt.status === 1 ? "!!! SUCCESS !!!" : "REVERTED AGAIN", receipt.status === 1 ? "cyan" : "red");

        } catch (e) {
            log("ERROR: " + e.message);
        }
    }
</script>
</body>
</html>
