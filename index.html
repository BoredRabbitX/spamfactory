<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>SPAMTEST | COMMAND CENTER v5</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --neon: #00ff41; --alert: #ff003c; --bg: #050505; --grey: #1a1a1a; }
        body { background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; display: grid; grid-template-columns: 1fr 400px; gap: 10px; padding: 10px; margin: 0; }
        .panel { border: 1px solid var(--neon); padding: 15px; background: rgba(0,0,0,0.9); }
        .header { grid-column: 1 / span 2; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--neon); padding-bottom: 10px; margin-bottom: 10px; }
        textarea { width: 100%; height: 200px; background: #000; color: var(--neon); border: 1px solid var(--grey); padding: 10px; box-sizing: border-box; }
        button { padding: 12px; cursor: pointer; border: none; font-weight: bold; transition: 0.3s; text-transform: uppercase; }
        .btn-connect { background: var(--neon); color: #000; }
        .btn-auto { background: var(--alert); color: #fff; }
        .btn-blast { background: #fff; color: #000; font-size: 1.2em; }
        #monitor { height: 500px; overflow-y: auto; background: #000; font-size: 11px; padding: 10px; border: 1px solid var(--grey); }
        .auto-active { box-shadow: 0 0 20px var(--alert); border-color: var(--alert); }
    </style>
</head>
<body>

<div class="header panel">
    <div>
        <h2 style="margin:0">‚ò£Ô∏è SPAMTEST CONTROL UNIT</h2>
        <small id="netStatus">Network: Offline</small>
    </div>
    <div id="walletInfo">
        <button class="btn-connect" onclick="connectWallet()">Connect MetaMask</button>
    </div>
</div>

<div class="left-col">
    <div id="controlPanel" class="panel">
        <div style="margin-bottom:15px">
            <label>TARGET LIST:</label>
            <textarea id="targetList" placeholder="Indirizzi acquisiti..."></textarea>
        </div>
        
        <button class="btn-auto" id="autoBtn" onclick="toggleAutoPilot()" disabled>Attiva Auto-Pilot (OFF)</button>
        <button style="background:var(--grey); color:white; width:100%" onclick="scrapeTarget()">Forza Scrape Rete</button>
        
        <hr style="border:1px solid var(--grey); margin:20px 0">
        
        <button class="btn-blast" id="blastBtn" onclick="launchBlast()" disabled>üî• Lancia Blast Manuale üî•</button>
    </div>
</div>

<div class="right-col">
    <div class="panel">
        <h3>SYSTEM LOGS</h3>
        <div id="monitor"></div>
    </div>
</div>

<script>
    const FACTORY_ADDR = "0x70c43bf1e1ae424c2f6cfe8df57ffc931462270f";
    const ABI = ["function launchBlast(address[] memory targets, uint256 amount) external"];
    const MASTER_OWNER = "0xa036B32c86E2aB7F2AdE9ACC15984B2A2DDe8977";
    
    let provider, signer, factoryContract, autoPilot = false;

    async function connectWallet() {
        if (!window.ethereum) return alert("Installa MetaMask!");
        
        try {
            provider = new ethers.BrowserProvider(window.ethereum);
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            signer = await provider.getSigner();
            const addr = await signer.getAddress();
            
            document.getElementById('walletInfo').innerHTML = `<span>User: ${addr.substring(0,6)}...${addr.substring(38)}</span>`;
            document.getElementById('netStatus').innerText = "Network: Connected";
            
            factoryContract = new ethers.Contract(FACTORY_ADDR, ABI, signer);
            
            // Abilita i tasti
            document.getElementById('autoBtn').disabled = false;
            document.getElementById('blastBtn').disabled = false;
            
            log("Wallet Connesso. Sistema Armato.");
            if(addr.toLowerCase() !== MASTER_OWNER.toLowerCase()) {
                log("ATTENZIONE: Non sei il Master Owner. Le transazioni falliranno.", "var(--alert)");
            }
        } catch (e) {
            log("Connessione fallita: " + e.message, "var(--alert)");
        }
    }

    function log(msg, color = "") {
        const m = document.getElementById('monitor');
        m.innerHTML = `<div style="color:${color}">[${new Date().toLocaleTimeString()}] ${msg}</div>` + m.innerHTML;
    }

    async function scrapeTarget() {
        log("Scansione blocchi in corso...");
        // Logica dummy per test: in produzione pescher√† tx reali
        let t = [];
        for(let i=0; i<8; i++) t.push(ethers.Wallet.createRandom().address);
        document.getElementById('targetList').value = t.join("\n");
        log(`Acquisiti ${t.length} target attivi.`);
        return t;
    }

    async function launchBlast() {
        const t = document.getElementById('targetList').value.split("\n").filter(x => x.startsWith("0x"));
        if(t.length === 0) return log("Errore: Nessun target.", "orange");

        try {
            log("Inizio transazione...");
            // Usiamo un gasLimit forzato per bypassare errori di stima su Paseo
            const tx = await factoryContract.launchBlast(t, 1000000, { gasLimit: 2000000 });
            log("Transazione Inviata! Hash: " + tx.hash.substring(0,16) + "...", "cyan");
            await tx.wait();
            log("SUCCESSO: Blast eseguito sul clone.", "var(--neon)");
        } catch (e) {
            log("FAIL: " + e.message, "var(--alert)");
        }
    }

    function toggleAutoPilot() {
        autoPilot = !autoPilot;
        const b = document.getElementById('autoBtn');
        const p = document.getElementById('controlPanel');
        
        if(autoPilot) {
            b.innerText = "Disattiva Auto-Pilot (ON)";
            b.style.background = "#fff"; b.style.color = "#000";
            p.classList.add('auto-active');
            log("MODALIT√Ä AUTOMATICA ATTIVATA.", "yellow");
            runCycle();
        } else {
            b.innerText = "Attiva Auto-Pilot (OFF)";
            b.style.background = "var(--alert)"; b.style.color = "#fff";
            p.classList.remove('auto-active');
            log("Modalit√† automatica disattivata.");
        }
    }

    async function runCycle() {
        if(!autoPilot) return;
        await scrapeTarget();
        await launchBlast();
        log("Attesa 60 secondi per il prossimo ciclo...");
        setTimeout(runCycle, 60000);
    }
</script>
</body>
</html>
