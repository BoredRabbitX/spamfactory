<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>OBSIDIAN v22 | BYPASS LIMIT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --neon: #00ff41; --bg: #050505; }
        body { background: var(--bg); color: var(--neon); font-family: monospace; padding: 20px; display: grid; grid-template-columns: 400px 1fr; gap: 20px; }
        .panel { border: 1px solid var(--neon); padding: 15px; background: #111; }
        #log { background: #000; border: 1px solid #222; height: 80vh; overflow-y: auto; padding: 10px; font-size: 11px; }
        input { width: 100%; background: #000; border: 1px solid #333; color: var(--neon); padding: 10px; margin: 10px 0; }
        .btn-v22 { width: 100%; padding: 20px; background: var(--neon); color: #000; font-weight: bold; border: none; cursor: pointer; }
    </style>
</head>
<body>

<div class="panel">
    <h2>VIPER v22 <span style="font-size: 10px; color: #666;">HIERARCHY</span></h2>
    <label>CURRENT FACTORY:</label>
    <input type="text" id="targetAddr" placeholder="Indirizzo da Remix">
    <label>PRIVATE KEY:</label>
    <input type="password" id="pKey">
    <button class="btn-v22" onclick="startInfection()">☣️ EXECUTE HIERARCHY</button>
    <div id="stats" style="margin-top:20px; font-size: 12px;">
        Gen: <span id="genNum">0</span><br>
        Name: <span id="genName">---</span>
    </div>
</div>

<div id="log"></div>

<script>
    const RPC = "https://testnet-passet-hub-eth-rpc.polkadot.io";
    const ABI = [
        "function infect(address[] targets, string nextName, string nextSymbol) external",
        "function generation() view returns (uint256)",
        "event Birth(address indexed daughter, uint256 gen)"
    ];
    let isRunning = false;

    async function startInfection() {
        if(isRunning) return;
        isRunning = true;
        loop();
    }

    async function loop() {
        if(!isRunning) return;
        const addr = document.getElementById('targetAddr').value.trim();
        const key = document.getElementById('pKey').value.trim();

        try {
            const provider = new ethers.JsonRpcProvider(RPC);
            const wallet = new ethers.Wallet(key, provider);
            const contract = new ethers.Contract(addr, ABI, wallet);

            const currentGen = await contract.generation();
            const nextGen = Number(currentGen) + 1;
            const nextName = `MATRIOSKA GEN ${nextGen}`;
            const nextSymbol = `MTR-${nextGen}`;

            document.getElementById('genNum').innerText = currentGen;
            document.getElementById('genName').innerText = `MATRIOSKA GEN ${currentGen}`;

            let targets = [];
            for(let i=0; i<30; i++) targets.push(ethers.Wallet.createRandom().address);

            log(`Lancio Blast da Gen ${currentGen}. Preparazione Gen ${nextGen}...`);
            
            const tx = await contract.infect(targets, nextName, nextSymbol, { gasLimit: 5000000 });
            const receipt = await tx.wait();

            const event = receipt.logs.find(l => l.topics[0] === ethers.id("Birth(address,uint256)"));
            const daughter = ethers.getAddress("0x" + event.topics[1].slice(26));

            log(`NATA FIGLIA: ${daughter} (${nextName})`, "yellow");
            document.getElementById('targetAddr').value = daughter;

            setTimeout(loop, 3000);

        } catch (e) {
            log("ERRORE: " + e.message, "red");
            isRunning = false;
        }
    }

    function log(msg, color="") {
        const c = document.getElementById('log');
        c.innerHTML = `<div style="color:${color}">[${new Date().toLocaleTimeString()}] ${msg}</div>` + c.innerHTML;
    }
</script>
</body>
</html>
